// ==UserScript==
// @name         Blue Marble
// @namespace    https://github.com/KeksTM/
// @version      0.78.12
// @description  A userscript to automate and/or enhance the user experience on Wplace.live. Make sure to comply with the site's Terms of Service, and rules! This script is not affiliated with Wplace.live in any way, use at your own risk. This script is not affiliated with TamperMonkey. The author of this userscript is not responsible for any damages, issues, loss of data, or punishment that may occur as a result of using this script. This script is provided "as is" under the MPL-2.0 license. The "Blue Marble" icon is licensed under CC0 1.0 Universal (CC0 1.0) Public Domain Dedication. The image is owned by NASA.
// @author       SwingTheVine
// @license      MPL-2.0
// @supportURL   https://discord.gg/tpeBPy46hf
// @homepageURL  https://github.com/x/Wplace-BlueMarble-Auto-Fill
// @icon         https://raw.githubusercontent.com/KeksTM/Wplace-BlueMarble-Auto-Fill/refs/heads/main/dist/assets/Favicon.png
// @updateURL    https://raw.githubusercontent.com/KeksTM/Wplace-BlueMarble-Auto-Fill/main/dist/BlueMarble.user.js
// @downloadURL  https://raw.githubusercontent.com/KeksTM/Wplace-BlueMarble-Auto-Fill/main/dist/BlueMarble.user.js
// @run-at       document-start
// @match        https://*.wplace.live/*
// @connect      *
// @grant        GM_getResourceText
// @grant        GM_addStyle
// @grant        GM.setValue
// @grant        GM_getValue
// @resource     CSS-BM-File https://raw.githubusercontent.com/KeksTM/Wplace-BlueMarble-Auto-Fill/refs/heads/main/dist/BlueMarble.user.css
// ==/UserScript==

// Wplace  --> https://wplace.live
// License --> https://www.mozilla.org/en-US/MPL/2.0/

(()=>{var t,e,n=t=>{throw TypeError(t)},o=(t,e,o)=>e.has(t)?n("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,o),i=(t,e,o)=>(((t,e)=>{e.has(t)||n("Cannot access private method")})(t,e),o),s=class{constructor(e,n){o(this,t),this.name=e,this.version=n,this.o=null,this.i="bm-b",this.l=null,this.u=null,this.h=[]}m(t){this.o=t}p(){return this.h.length>0&&(this.u=this.h.pop()),this}$(t){t?.appendChild(this.l),this.l=null,this.u=null,this.h=[]}T(n={},o=()=>{}){return o(this,i(this,t,e).call(this,"div",{},n)),this}v(n={},o=()=>{}){return o(this,i(this,t,e).call(this,"p",{},n)),this}L(n={},o=()=>{}){return o(this,i(this,t,e).call(this,"small",{},n)),this}I(n={},o=()=>{}){return o(this,i(this,t,e).call(this,"img",{},n)),this}M(n,o={},s=()=>{}){return s(this,i(this,t,e).call(this,"h"+n,{},o)),this}O(n={},o=()=>{}){return o(this,i(this,t,e).call(this,"hr",{},n)),this}k(n={},o=()=>{}){return o(this,i(this,t,e).call(this,"br",{},n)),this}C(n={},o=()=>{}){const s=i(this,t,e).call(this,"label",{textContent:n.textContent??""});delete n.textContent;const a=i(this,t,e).call(this,"input",{type:"checkbox"},n);return s.insertBefore(a,s.firstChild),this.p(),o(this,s,a),this}F(n={},o=()=>{}){return o(this,i(this,t,e).call(this,"button",{},n)),this}A(n={},o=()=>{}){const s=n.title??n.textContent??"Help: No info";delete n.textContent,n.title=`Help: ${s}`;const a={textContent:"?",className:"bm-q",onclick:()=>{this.S(this.i,s)}};return o(this,i(this,t,e).call(this,"button",a,n)),this}U(n={},o=()=>{}){return o(this,i(this,t,e).call(this,"input",{},n)),this}P(n={},o=()=>{}){const s=n.textContent??"";delete n.textContent;const a=i(this,t,e).call(this,"div"),c=i(this,t,e).call(this,"input",{type:"file",style:"display: none !important; visibility: hidden !important; position: absolute !important; left: -9999px !important; width: 0 !important; height: 0 !important; opacity: 0 !important;"},n);this.p();const r=i(this,t,e).call(this,"button",{textContent:s});return this.p(),this.p(),c.setAttribute("tabindex","-1"),c.setAttribute("aria-hidden","true"),r.addEventListener("click",()=>{c.click()}),c.addEventListener("change",()=>{r.style.maxWidth=`${r.offsetWidth}px`,c.files.length>0?r.textContent=c.files[0].name:r.textContent=s}),o(this,a,c,r),this}D(n={},o=()=>{}){return o(this,i(this,t,e).call(this,"textarea",{},n)),this}S(t,e,n=!1){const o=document.getElementById(t.replace(/^#/,""));o&&(o instanceof HTMLInputElement?o.value=e:n?o.textContent=e:o.innerHTML=e)}N(t,e){let n,o=!1,i=0,s=null,a=0,c=0,r=0,l=0;if(t=document.querySelector("#"==t?.[0]?t:"#"+t),e=document.querySelector("#"==e?.[0]?e:"#"+e),!t||!e)return void this.B(`Can not drag! ${t?"":"moveMe"} ${t||e?"":"and "}${e?"":"iMoveThings "}was not found!`);const u=()=>{if(o){const e=Math.abs(a-r),n=Math.abs(c-l);(e>.5||n>.5)&&(a=r,c=l,t.style.transform=`translate(${a}px, ${c}px)`,t.style.left="0px",t.style.top="0px",t.style.right=""),s=requestAnimationFrame(u)}};let d=null;const h=(h,m)=>{o=!0,d=t.getBoundingClientRect(),n=h-d.left,i=m-d.top;const p=window.getComputedStyle(t).transform;if(p&&"none"!==p){const t=new DOMMatrix(p);a=t.m41,c=t.m42}else a=d.left,c=d.top;r=a,l=c,document.body.style.userSelect="none",e.classList.add("dragging"),s&&cancelAnimationFrame(s),u()},m=()=>{o=!1,s&&(cancelAnimationFrame(s),s=null),document.body.style.userSelect="",e.classList.remove("dragging")};e.addEventListener("mousedown",function(t){t.preventDefault(),h(t.clientX,t.clientY)}),e.addEventListener("touchstart",function(t){const e=t?.touches?.[0];e&&(h(e.clientX,e.clientY),t.preventDefault())},{passive:!1}),document.addEventListener("mousemove",function(t){o&&d&&(r=t.clientX-n,l=t.clientY-i)},{passive:!0}),document.addEventListener("touchmove",function(t){if(o&&d){const e=t?.touches?.[0];if(!e)return;r=e.clientX-n,l=e.clientY-i,t.preventDefault()}},{passive:!1}),document.addEventListener("mouseup",m),document.addEventListener("touchend",m),document.addEventListener("touchcancel",m)}R(t){(0,console.info)(`${this.name}: ${t}`),this.S(this.i,"Status: "+t,!0)}B(t){(0,console.error)(`${this.name}: ${t}`),this.S(this.i,"Error: "+t,!0)}};function a(t,e){if(0===t)return e[0];let n="";const o=e.length;for(;t>0;)n=e[t%o]+n,t=Math.floor(t/o);return n}function c(t){let e="";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function r(t){const e=atob(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n}t=new WeakSet,e=function(t,e={},n={}){const o=document.createElement(t);this.l?(this.u?.appendChild(o),this.h.push(this.u),this.u=o):(this.l=o,this.u=o);for(const[t,n]of Object.entries(e))o[t]=n;for(const[t,e]of Object.entries(n))o[t]=e;return o};var l,u,d,h=class{constructor({displayName:t="My template",W:e=0,G:n="",url:o="",file:i=null,coords:s=null,Y:a=null,j:c=1e3}={}){this.displayName=t,this.W=e,this.G=n,this.url=o,this.file=i,this.coords=s,this.Y=a,this.j=c,this.J=0}async X(){console.log("Template coordinates:",this.coords);const t=await createImageBitmap(this.file),e=t.width,n=t.height,o=e*n;console.log(`Template pixel analysis - Dimensions: ${e}×${n} = ${o.toLocaleString()} pixels`),this.J=o;const i={},s={},a=new OffscreenCanvas(this.j,this.j),r=a.getContext("2d",{q:!0});for(let o=this.coords[3];o<n+this.coords[3];){const l=Math.min(this.j-o%this.j,n-(o-this.coords[3]));console.log(`Math.min(${this.j} - (${o} % ${this.j}), ${n} - (${o-this.coords[3]}))`);for(let n=this.coords[2];n<e+this.coords[2];){console.log(`Pixel X: ${n}\nPixel Y: ${o}`);const u=Math.min(this.j-n%this.j,e-(n-this.coords[2]));console.log(`Math.min(${this.j} - (${n} % ${this.j}), ${e} - (${n-this.coords[2]}))`),console.log(`Draw Size X: ${u}\nDraw Size Y: ${l}`);const d=3*u,h=3*l;a.width=d,a.height=h,console.log(`Draw X: ${u}\nDraw Y: ${l}\nCanvas Width: ${d}\nCanvas Height: ${h}`),r.imageSmoothingEnabled=!1,console.log(`Getting X ${n}-${n+u}\nGetting Y ${o}-${o+l}`),r.clearRect(0,0,d,h),r.drawImage(t,n-this.coords[2],o-this.coords[3],u,l,0,0,3*u,3*l);const m=r.getImageData(0,0,d,h);for(let t=0;t<h;t++)for(let e=0;e<d;e++)if(e%3!=1||t%3!=1){const n=4*(t*d+e);m.data[n+3]=0}console.log(`Shreaded pixels for ${n}, ${o}`,m),r.putImageData(m,0,0);const p=`${(this.coords[0]+Math.floor(n/1e3)).toString().padStart(4,"0")},${(this.coords[1]+Math.floor(o/1e3)).toString().padStart(4,"0")},${(n%1e3).toString().padStart(3,"0")},${(o%1e3).toString().padStart(3,"0")}`;i[p]=await createImageBitmap(a);const b=await a.convertToBlob(),f=await b.arrayBuffer(),g=Array.from(new Uint8Array(f));s[p]=c(g),console.log(i),n+=u}o+=l}return console.log("Template Tiles: ",i),console.log("Template Tiles Buffers: ",s),{H:i,_:s}}};l=new WeakSet,u=async function(){GM.setValue("bmTemplates",JSON.stringify(this.V))},d=async function(t){console.log("Parsing BlueMarble...");const e=t.templates;if(console.log(`BlueMarble length: ${Object.keys(e).length}`),Object.keys(e).length>0)for(const t in e){const n=t,o=e[t];if(console.log(n),e.hasOwnProperty(t)){const t=n.split(" "),e=Number(t?.[0]),i=t?.[1]||"0",s=o.name||`Template ${e||""}`,a=o.tiles,c={};for(const t in a)if(console.log(t),a.hasOwnProperty(t)){const e=r(a[t]),n=new Blob([e],{type:"image/png"}),o=await createImageBitmap(n);c[t]=o}const l=new h({displayName:s,W:e||this.Z?.length||0,G:i||""});l.Y=c,this.Z.push(l),console.log(this.Z),console.log("^^^ This ^^^")}}};var m=GM_info.script.name.toString(),p=GM_info.script.version.toString();!function(t){const e=document.createElement("script");e.setAttribute("bm-r",m),e.setAttribute("bm-o","color: cornflowerblue;"),e.textContent=`(${t})();`,document.documentElement?.appendChild(e),e.remove()}(()=>{const t=document.currentScript,e=t?.getAttribute("bm-r")||"Blue Marble",n=t?.getAttribute("bm-o")||"",o=new Map;window.addEventListener("message",t=>{const{source:i,endpoint:s,blobID:a,blobData:c,blink:r}=t.data,l=Date.now()-r;if(console.groupCollapsed(`%c${e}%c: ${o.size} Recieved IMAGE message about blob "${a}"`,n,""),console.log(`Blob fetch took %c${String(Math.floor(l/6e4)).padStart(2,"0")}:${String(Math.floor(l/1e3)%60).padStart(2,"0")}.${String(l%1e3).padStart(3,"0")}%c MM:SS.mmm`,n,""),console.log(o),console.groupEnd(),"blue-marble"==i&&a&&c&&!s){const t=o.get(a);"function"==typeof t?t(c):function(...t){(0,console.warn)(...t)}(`%c${e}%c: Attempted to retrieve a blob (%s) from queue, but the blobID was not a function! Skipping...`,n,"",a),o.delete(a)}});const i=window.fetch;window.fetch=async function(...t){const s=(t[0]instanceof Request?t[0]?.url:t[0])||"ignore",a=(t[1],await i.apply(this,t)),c=a.clone(),r=s,l=c.headers.get("content-type")||"";if(l.includes("application/json"))console.log(`%c${e}%c: Sending JSON message about endpoint "${r}"`,n,""),c.json().then(t=>{window.postMessage({source:"blue-marble",endpoint:r,jsonData:t},"*")}).catch(t=>{console.error(`%c${e}%c: Failed to parse JSON: `,n,"",t)});else if(l.includes("image/")&&!r.includes("openfreemap")&&!r.includes("maps")){const t=Date.now(),i=await c.blob();return console.log(`%c${e}%c: ${o.size} Sending IMAGE message about endpoint "${r}"`,n,""),new Promise(s=>{const a=crypto.randomUUID();o.set(a,t=>{s(new Response(t,{headers:c.headers,status:c.status,statusText:c.statusText})),console.log(`%c${e}%c: ${o.size} Processed blob "${a}"`,n,"")}),window.postMessage({source:"blue-marble",endpoint:r,blobID:a,blobData:i,blink:t})}).catch(i=>{const s=Date.now();console.error(`%c${e}%c: Failed to Promise blob!`,n,""),console.groupCollapsed(`%c${e}%c: Details of failed blob Promise:`,n,""),console.log(`Endpoint: ${r}\nThere are ${o.size} blobs processing...\nBlink: ${t.toLocaleString()}\nTime Since Blink: ${String(Math.floor(s/6e4)).padStart(2,"0")}:${String(Math.floor(s/1e3)%60).padStart(2,"0")}.${String(s%1e3).padStart(3,"0")} MM:SS.mmm`),console.error("Exception stack:",i),console.groupEnd()})}return a}});var b=GM_getResourceText("CSS-BM-File");GM_addStyle(b);var f=document.createElement("link");f.href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap",f.rel="preload",f.as="style",f.onload=function(){this.onload=null,this.rel="stylesheet"},document.head?.appendChild(f),new class{constructor(){this.K=null,this.tt=null,this.et="#bm-5"}nt(t){return this.tt=t,this.K=new MutationObserver(t=>{for(const e of t)for(const t of e.addedNodes)t instanceof HTMLElement&&t.matches?.(this.et)}),this}ot(){return this.K}observe(t,e=!1,n=!1){t.observe(this.tt,{childList:e,subtree:n})}};var g=new s(m,p),$=(new s(m,p),new class{constructor(t,e,n){o(this,l),this.name=t,this.version=e,this.l=n,this.it="1.0.0",this.st=null,this.ct="!#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~",this.j=1e3,this.rt=3,this.lt=null,this.ut=null,this.dt="bm-p",this.ht="div#map canvas.maplibregl-canvas",this.bt=null,this.ft="",this.Z=[],this.V=null,this.gt=!0}$t(){if(document.body.contains(this.lt))return this.lt;document.getElementById(this.dt)?.remove();const t=document.querySelector(this.ht),e=document.createElement("canvas");return e.id=this.dt,e.className="maplibregl-canvas",e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.height=t?.clientHeight*(window.devicePixelRatio||1)+"px",e.style.width=t?.clientWidth*(window.devicePixelRatio||1)+"px",e.height=t?.clientHeight*(window.devicePixelRatio||1),e.width=t?.clientWidth*(window.devicePixelRatio||1),e.style.zIndex="8999",e.style.pointerEvents="none",t?.parentElement?.appendChild(e),this.lt=e,window.addEventListener("move",this.wt),window.addEventListener("zoom",this.xt),window.addEventListener("resize",this.yt),this.lt}async Tt(){return{whoami:this.name.replace(" ",""),scriptVersion:this.version,schemaVersion:this.it,templates:{}}}async vt(t,e,n){this.V||(this.V=await this.Tt(),console.log("Creating JSON...")),this.l.R(`Creating template at ${n.join(", ")}...`);const o=new h({displayName:e,W:0,G:a(this.st||0,this.ct),file:t,coords:n}),{H:s,_:c}=await o.X(this.j);o.Y=s,this.V.templates[`${o.W} ${o.G}`]={name:o.displayName,coords:n.join(", "),enabled:!0,tiles:c},this.Z=[],this.Z.push(o);const r=(new Intl.NumberFormat).format(o.J);this.l.R(`Template created at ${n.join(", ")}! Total pixels: ${r}`),console.log(Object.keys(this.V.templates).length),console.log(this.V),console.log(this.Z),console.log(JSON.stringify(this.V)),await i(this,l,u).call(this)}Lt(){}async It(){this.V||(this.V=await this.Tt(),console.log("Creating JSON..."))}async Mt(t,e){if(!this.gt)return t;const n=this.j*this.rt;e=e[0].toString().padStart(4,"0")+","+e[1].toString().padStart(4,"0"),console.log(`Searching for templates in tile: "${e}"`);const o=this.Z;console.log(o),o.sort((t,e)=>t.W-e.W),console.log(o);const i=o.map(t=>{const n=Object.keys(t.Y).filter(t=>t.startsWith(e));if(0===n.length)return null;const o=n.map(e=>{const n=e.split(",");return{Ot:t.Y[e],kt:[n[0],n[1]],Ct:[n[2],n[3]]}});return o?.[0]}).filter(Boolean);console.log(i);const s=i?.length||0;if(console.log(`templateCount = ${s}`),s>0){const t=o.filter(t=>Object.keys(t.Y).filter(t=>t.startsWith(e)).length>0).reduce((t,e)=>t+(e.J||0),0),n=(new Intl.NumberFormat).format(t);this.l.R(`Displaying ${s} template${1==s?"":"s"}.\nTotal pixels: ${n}`)}else this.l.R(`Displaying ${s} templates.`);const a=await createImageBitmap(t),c=new OffscreenCanvas(n,n),r=c.getContext("2d");r.imageSmoothingEnabled=!1,r.beginPath(),r.rect(0,0,n,n),r.clip(),r.clearRect(0,0,n,n),r.drawImage(a,0,0,n,n);for(const t of i)console.log("Template:"),console.log(t),r.drawImage(t.Ot,Number(t.Ct[0])*this.rt,Number(t.Ct[1])*this.rt);return await c.convertToBlob({type:"image/png"})}Ft(t){console.log("Importing JSON..."),console.log(t),"BlueMarble"==t?.whoami&&i(this,l,d).call(this,t)}At(t){this.gt=t}}(m,p,g)),w=new class{constructor(t){this.St=t,this.Ut=!1,this.Pt=[],this.Dt=[],this.droplets=0,this.charges=null,this.extraColorsBitmap=null}async Nt(){try{const t=await fetch("https://backend.wplace.live/me",{credentials:"include"});if(t.ok){const e=await t.json();return console.log("ApiManager: Fetched fresh user data:",e),void 0!==e.extraColorsBitmap&&(this.extraColorsBitmap=e.extraColorsBitmap),void 0!==e.droplets&&(this.droplets=e.droplets),void 0!==e.charges&&(this.charges=e.charges),void 0!==e.id&&(this.St.st=e.id),e}return console.warn("ApiManager: Failed to fetch user data:",t.status),null}catch(t){return console.error("ApiManager: Error fetching user data:",t),null}}Et(t){window.addEventListener("message",async e=>{const n=e.data,o=n.jsonData;if(!n||"blue-marble"!==n.source)return;if(!n.endpoint)return;const i=n.endpoint?.split("?")[0].split("/").filter(t=>t&&isNaN(Number(t))).filter(t=>t&&!t.includes(".")).pop();switch(console.log('%cBlue Marble%c: Recieved message about "%s"',"color: cornflowerblue;","",i),i){case"me":if(o.status&&"2"!=o.status?.toString()[0])return void t.B("You are not logged in!\nCould not fetch userdata.");const e=Math.ceil(Math.pow(Math.floor(o.level)*Math.pow(30,.65),1/.65)-o.pixelsPainted);console.log(o.id),(o.id||0===o.id)&&console.log(a(o.id,"!#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~")),this.St.st=o.id,this.droplets=o.droplets,this.charges=o.charges,this.extraColorsBitmap=o.extraColorsBitmap,t.S("bm-h",`Username: <b>${function(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}(o.name)}</b>`),t.S("bm-c",`Droplets: <b>${(new Intl.NumberFormat).format(o.droplets)}</b>`),t.S("bm-6",`Next level in <b>${(new Intl.NumberFormat).format(e)}</b> pixel${1==e?"":"s"}`);break;case"pixel":const i=n.endpoint.split("?")[0].split("/").filter(t=>t&&!isNaN(Number(t))),r=new URLSearchParams(n.endpoint.split("?")[1]),l=[r.get("x"),r.get("y")];if(this.Pt.length&&(!i.length||!l.length))return void t.B("Coordinates are malformed!\nDid you try clicking the canvas first?");this.Pt=[...i,...l];const u=(s=i,c=l,[parseInt(s[0])%4*1e3+parseInt(c[0]),parseInt(s[1])%4*1e3+parseInt(c[1])]),d=document.querySelectorAll("span");for(const t of d)if(t.textContent.trim().includes(`${u[0]}, ${u[1]}`)){let e=document.querySelector("#bm-5");const n=`(Tl X: ${i[0]}, Tl Y: ${i[1]}, Px X: ${l[0]}, Px Y: ${l[1]})`;e?e.textContent=n:(e=document.createElement("span"),e.id="bm-5",e.textContent=n,e.style="margin-left: calc(var(--spacing)*3); font-size: small;",t.parentNode.parentNode.parentNode.insertAdjacentElement("afterend",e))}break;case"tiles":let h=n.endpoint.split("/");h=[parseInt(h[h.length-2]),parseInt(h[h.length-1].replace(".png",""))];const m=n.blobID,p=n.blobData,b=await this.St.Mt(p,h);window.postMessage({source:"blue-marble",blobID:m,blobData:b,blink:n.blink});break;case"robots":this.Ut="false"==o.userscript?.toString().toLowerCase();break}var s,c})}}($);g.m(w);var x=JSON.parse(GM_getValue("bmTemplates","{}"));console.log(x),$.Ft(x),function(){let t=!1;g.T({id:"bm-n",style:"top: 10px; right: 75px;"}).T({id:"bm-7"}).T({id:"bm-i"}).p().I({alt:"Blue Marble Icon - Click to minimize/maximize",src:"https://raw.githubusercontent.com/SwingTheVine/Wplace-BlueMarble/main/dist/assets/Favicon.png",style:"cursor: pointer;"},(e,n)=>{n.addEventListener("click",()=>{t=!t;const o=document.querySelector("#bm-n"),i=document.querySelector("#bm-7"),s=document.querySelector("#bm-i"),a=document.querySelector("#bm-8"),c=document.querySelector("#bm-d"),r=document.querySelector("#bm-e"),l=document.querySelector("#bm-f"),u=document.querySelector("#bm-9"),d=document.querySelectorAll("#bm-8 input");t||(o.style.width="auto",o.style.maxWidth="300px",o.style.minWidth="200px",o.style.padding="10px"),["#bm-n h1","#bm-4","#bm-n hr","#bm-3 > *:not(#bm-8)","#bm-2","#bm-1",`#${e.i}`,"#bm-A"].forEach(e=>{document.querySelectorAll(e).forEach(e=>{e.style.display=t?"none":""})}),t?(a&&(a.style.display="none"),c&&(c.style.display="none"),r&&(r.style.display="none"),l&&(l.style.display="none"),u&&(u.style.display="none"),d.forEach(t=>{t.style.display="none"}),o.style.width="60px",o.style.height="76px",o.style.maxWidth="60px",o.style.minWidth="60px",o.style.padding="8px",n.style.marginLeft="3px",i.style.textAlign="center",i.style.margin="0",i.style.marginBottom="0",s&&(s.style.display="",s.style.marginBottom="0.25em")):(a&&(a.style.display="",a.style.flexDirection="",a.style.justifyContent="",a.style.alignItems="",a.style.gap="",a.style.textAlign="",a.style.margin=""),c&&(c.style.display=""),r&&(r.style.display="",r.style.marginTop=""),l&&(l.style.display="",l.style.marginTop=""),u&&(u.style.display="",u.style.marginTop=""),d.forEach(t=>{t.style.display=""}),n.style.marginLeft="",o.style.padding="10px",i.style.textAlign="",i.style.margin="",i.style.marginBottom="",s&&(s.style.marginBottom="0.5em"),o.style.width="",o.style.height=""),n.alt=t?"Blue Marble Icon - Minimized (Click to maximize)":"Blue Marble Icon - Maximized (Click to minimize)"})}).p().M(1,{textContent:m}).p().p().O().p().T({id:"bm-4"}).v({id:"bm-h",textContent:"Username:"}).p().v({id:"bm-c",textContent:"Droplets:"}).p().v({id:"bm-6",textContent:"Next level in..."}).p().p().O().p().T({id:"bm-3"}).T({id:"bm-8"}).F({id:"bm-d",className:"bm-q",style:"margin-top: 0;",innerHTML:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 6"><circle cx="2" cy="2" r="2"></circle><path d="M2 6 L3.7 3 L0.3 3 Z"></path><circle cx="2" cy="2" r="0.7" fill="white"></circle></svg></svg>'},(t,e)=>{e.onclick=()=>{const e=t.o?.Pt;e?.[0]?(t.S("bm-j",e?.[0]||""),t.S("bm-k",e?.[1]||""),t.S("bm-l",e?.[2]||""),t.S("bm-m",e?.[3]||"")):t.B("Coordinates are malformed! Did you try clicking on the canvas first?")}}).p().U({type:"number",id:"bm-j",placeholder:"Tl X",min:0,max:2047,step:1,required:!0}).p().U({type:"number",id:"bm-k",placeholder:"Tl Y",min:0,max:2047,step:1,required:!0}).p().U({type:"number",id:"bm-l",placeholder:"Px X",min:0,max:2047,step:1,required:!0}).p().U({type:"number",id:"bm-m",placeholder:"Px Y",min:0,max:2047,step:1,required:!0}).p().p().P({id:"bm-2",textContent:"Upload Template",accept:"image/png, image/jpeg, image/webp, image/bmp, image/gif"}).p().T({id:"bm-0"}).F({id:"bm-f",textContent:"Enable"},(t,e)=>{e.onclick=()=>{t.o?.St?.At(!0),t.R("Enabled templates!");const e=document.querySelector("#bm-B"),n=document.querySelector("#bm-O"),o=document.querySelector("#bm-H");t.o?.St?.Z.length&&t.o?.St?.gt&&(e&&(e.disabled=!1),n&&(n.disabled=!1),o&&(o.disabled=!1))}}).p().F({id:"bm-e",textContent:"Create"},(t,e)=>{e.onclick=async()=>{const e=document.querySelector("#bm-2"),n=document.querySelector("#bm-j");if(!n.checkValidity())return n.reportValidity(),void t.B("Coordinates are malformed! Did you try clicking on the canvas first?");const o=document.querySelector("#bm-k");if(!o.checkValidity())return o.reportValidity(),void t.B("Coordinates are malformed! Did you try clicking on the canvas first?");const i=document.querySelector("#bm-l");if(!i.checkValidity())return i.reportValidity(),void t.B("Coordinates are malformed! Did you try clicking on the canvas first?");const s=document.querySelector("#bm-m");if(!s.checkValidity())return s.reportValidity(),void t.B("Coordinates are malformed! Did you try clicking on the canvas first?");e?.files[0]?(await $.vt(e.files[0],e.files[0]?.name.replace(/\.[^/.]+$/,""),[Number(n.value),Number(o.value),Number(i.value),Number(s.value)]),t.R("Drew to canvas!")):t.B("No file selected!")}}).p().F({id:"bm-9",textContent:"Disable"},(t,e)=>{e.onclick=()=>{t.o?.St?.At(!1),t.R("Disabled templates!");const e=document.querySelector("#bm-B"),n=document.querySelector("#bm-O"),o=document.querySelector("#bm-H");e&&(e.disabled=!0),n&&(n.disabled=!0),o&&(o.disabled=!0)}}).p().F({id:"bm-B",textContent:"Auto Fill",disabled:!0},(t,e)=>{let n=!1;const o=new Set,i=t=>new Promise(e=>setTimeout(e,t)),s={0:[0,0,0,0],1:[0,0,0,255],2:[60,60,60,255],3:[120,120,120,255],4:[210,210,210,255],5:[255,255,255,255],6:[96,0,24,255],7:[237,28,36,255],8:[255,127,39,255],9:[246,170,9,255],10:[249,221,59,255],11:[255,250,188,255],12:[14,185,104,255],13:[19,230,123,255],14:[135,255,94,255],15:[12,129,110,255],16:[16,174,166,255],17:[19,225,190,255],18:[40,80,158,255],19:[64,147,228,255],20:[96,247,242,255],21:[107,80,246,255],22:[153,177,251,255],23:[120,12,153,255],24:[170,56,185,255],25:[224,159,249,255],26:[203,0,122,255],27:[236,31,128,255],28:[243,141,169,255],29:[104,70,52,255],30:[149,104,42,255],31:[248,178,119,255],32:[170,170,170,255],33:[165,14,30,255],34:[250,128,114,255],35:[228,92,26,255],36:[214,181,148,255],37:[156,132,49,255],38:[197,173,49,255],39:[232,212,95,255],40:[74,107,58,255],41:[90,148,74,255],42:[132,197,115,255],43:[15,121,159,255],44:[187,250,242,255],45:[125,199,255,255],46:[77,49,184,255],47:[74,66,132,255],48:[122,113,196,255],49:[181,174,241,255],50:[219,164,99,255],51:[209,128,81,255],52:[255,197,165,255],53:[155,82,73,255],54:[209,128,120,255],55:[250,182,164,255],56:[123,99,82,255],57:[156,132,107,255],58:[51,57,65,255],59:[109,117,141,255],60:[179,185,209,255],61:[109,100,63,255],62:[148,140,107,255],63:[205,197,158,255]},a=t=>{const e=Math.floor(t/3600),n=Math.floor(t%3600/60),o=Math.floor(t%60);return`${e.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`},c=t=>{const e=document.querySelector("#bm-A");if(e){const n=`[${(new Date).toLocaleTimeString()}] ${t}`;e.value=n+"\n";const o=e.value.split("\n");o.length>20&&(e.value=o.slice(0,20).join("\n")),e.scrollTop=0}},r=t=>{const e=document.querySelector("#bm-z"),n=30*t;if(e){let o=`Remaining Pixels: ${t.toLocaleString()}`;o+=null!==n&&n>0?`\nEstimated Time: ${a(n)}`:"\nEstimated Time: N/A",e.value=o}},l=async(t,e={})=>{const{Bt:n=100,Rt:o=!1,Wt:s=200,zt:a="AUTOFILL",description:r="element",Gt:l=""}=e;let u=document.querySelector(t),d=0;for(console.log(`${a}: Looking for ${r}${l}...`),c(`🔍 Looking for ${r}${l}...`);(!u||o&&u.disabled)&&d<n;){d++;const e=`${a}: Waiting for ${r} to be ready${l}... (${d}s/${n}s)`;console.log(e),c(`⏳ Waiting for ${r} to be ready${l}... (${d}s/${n}s)`),await i(s),u=document.querySelector(t)}return u?o&&u.disabled?(c(`❌ ${r} still disabled after waiting${l}`),console.error(`${a}: ${r} still disabled after waiting${l}`),{Yt:!1,element:u,reason:"disabled"}):(c(`✅ ${r} is ready${l}`),console.log(`${a}: ${r} is ready${l}`),{Yt:!0,element:u,reason:"ready"}):(c(`❌ ${r} not found after waiting${l}`),console.error(`${a}: ${r} not found after waiting${l}`),{Yt:!1,element:null,reason:"not_found"})};function u(t){const e=[];for(let t=0;t<=31;t++)e.push(t);if(t&&t>0)for(let n=32;n<64;n++)t&1<<n-32&&e.push(n);return e.sort((t,e)=>t-e)}const d=(t,e,n,o)=>{if(0===o)return 0;let i=1/0,a=1;for(const[o,[c,r,l]]of Object.entries(s)){if("0"===o)continue;const s=Math.sqrt((t-c)**2+(e-r)**2+(n-l)**2);s<i&&(i=s,a=parseInt(o))}return a},h=async(t,e)=>{try{const n=await fetch(`https://backend.wplace.live/files/s0/tiles/${t}/${e}.png`);if(!n.ok)return console.log(`Chunk ${t},${e} not found or empty`),null;const o=await n.blob();return await createImageBitmap(o)}catch(n){return console.warn(`Failed to fetch chunk ${t},${e}:`,n),null}},m=async(e,n=[])=>{const i={};if(!t.o?.St?.Z?.length)return[];const s=t.o.St.Z[0].Y;if(!s)return t.B("Template has no pixel data (chunked property is missing)."),[];const a=new Set(n),c=Object.keys(s).sort(),r=new Map,l=new Set,u=[];for(const t of c){const e=s[t];if(!e)continue;const i=t.split(",").map(Number),[c,m,p,b]=i;console.log(`Processing tile - ChunkX: ${c}, ChunkY: ${m}, TileCoordX: ${p}, TileCoordY: ${b}`);const f=`${c},${m}`;if(!r.has(f)){const t=await h(c,m);r.set(f,t)}const g=r.get(f),$=new OffscreenCanvas(e.width,e.height).getContext("2d");$.drawImage(e,0,0);const w=$.getImageData(0,0,e.width,e.height);let x=null;if(g){const t=new OffscreenCanvas(g.width,g.height).getContext("2d");t.drawImage(g,0,0),x=t.getImageData(0,0,g.width,g.height)}for(let t=1;t<e.height;t+=3)for(let i=1;i<e.width;i+=3){const s=4*(t*e.width+i),r=w.data[s+3];if(0===r)continue;const h=w.data[s],f=w.data[s+1],g=w.data[s+2],$=d(h,f,g,r),y=p+Math.floor((i-1)/3),T=b+Math.floor((t-1)/3),v=`${c},${m},${y},${T}`;if(l.add(v),n.length>0&&!a.has($))continue;let L=!0;if(x&&y>=0&&y<x.width&&T>=0&&T<x.height){const t=4*(T*x.width+y),e=x.data[t],n=x.data[t+1],o=x.data[t+2],i=x.data[t+3];d(e,n,o,i)===$&&(L=!1)}L&&!o.has(v)&&u.push({jt:c,Jt:m,Xt:y,qt:T,Ht:$,_t:v})}}const m=document.querySelector("#bm-O"),p=m?m.textContent.replace("Mode: ",""):"Random",b=t=>{console.log("AUTOFILL: Ran Edge Pixel");const e=1e3*t.jt+t.Xt,n=1e3*t.Jt+t.qt,o=[[e-1,n-1],[e,n-1],[e+1,n-1],[e-1,n],[e+1,n],[e-1,n+1],[e,n+1],[e+1,n+1]];for(const[t,e]of o){const n=Math.floor(t/1e3),o=Math.floor(e/1e3),i=`${n},${o},${t-1e3*n},${e-1e3*o}`;if(!l.has(i))return!0}return!1},f=u.filter(t=>b(t)),g=u.filter(t=>!b(t));console.log(`DEBUG: Total pixels to place: ${u.length}, Edge pixels: ${f.length}, Non-edge pixels: ${g.length}`);let $=[];if("Scan"===p)$=[...f,...g],console.log(`📏 Scan mode: ${$.length} total pixels in top-left to bottom-right scan order`);else{const t=t=>{const e=[...t];for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e};$=[...t(f),...t(g)],console.log(`🎲 Random mode: ${f.length} edge pixels first (randomized), then ${g.length} inner pixels (randomized)`)}let w=0;for(const t of $){if(w>=e)break;const n=`${t.jt},${t.Jt}`;i[n]||(i[n]={Vt:[t.jt,t.Jt],Zt:[]}),i[n].Zt.push([t.Xt,t.qt,t.Ht]),w++}return console.log(`\n📊 SUMMARY: Found ${u.length} total pixels that need placement (filtered by ${n.length} owned colors), returning ${w} pixels (${f.length} edge priority)`),{Kt:Object.values(i).map(t=>[t.Vt,t.Zt]),Qt:u.length}},p=async(t,e,n=0)=>{if(!e||0===e.length)return;const[o,s]=t,a=(t,n,i)=>({te:{colors:e.map(([,,t])=>t),coords:e.flatMap(([t,e])=>[t,e]),t:n},ee:`https://backend.wplace.live/s0/pixel/${o}/${s}`}),r=async()=>{const t=document.querySelector(".maplibregl-canvas");if(!t)throw new Error("Could not find the map canvas.");const e=window.innerWidth/2,n=window.innerHeight/2,o=["mousedown","click","mouseup"];for(const s of o){const o=new MouseEvent(s,{clientX:e,clientY:n,bubbles:!0});t.dispatchEvent(o),await i(50)}console.log("AUTOFILL: Starting...");const s=await l(".btn.btn-primary.btn-lg.sm\\:btn-xl.relative",{Bt:100,Rt:!0,Wt:200,zt:"AUTOFILL",description:"final pixel placement button",Gt:""});if(!s.Yt)throw new Error(`Could not find or enable final paint button: ${s.reason}`);console.log("AUTOFILL: Final button is ready - clicking now"),s.element.click()};try{const i=await(async(t,e,n="REQUEST")=>{const o=unsafeWindow.fetch;let i=!0;return new Promise(async(s,a)=>{unsafeWindow.fetch=async(...e)=>{const c=e[0],r=e[1]||{},l=(r.method||"GET").toUpperCase();if(!i)return o.apply(unsafeWindow,e);if("POST"!==l||"string"!=typeof c||!c.includes("/pixel/"))return o.apply(unsafeWindow,e);try{console.log(`${n}: Intercepting fetch request`);const e=JSON.parse(r.body),a=e.t;if(!a)throw new Error("Could not find security token 't'");const{te:l,ee:u}=t(e,a,c),d={...r,body:JSON.stringify(l)};i=!1,unsafeWindow.fetch=o,console.log(`${n}: Sending modified request`);const h=await o.call(unsafeWindow,u||c,d);return s(h),h}catch(t){i=!1,unsafeWindow.fetch=o,console.error(`${n}: Error during interception:`,t),a(t)}};try{await e()}catch(t){unsafeWindow.fetch=o,a(t)}})})(a,r,"AUTOFILL");return 429===i.status?(console.log(`Rate limited (429) on chunk ${o},${s}. Waiting 30s before retry...`),c(`⏰ Rate limited! Waiting 30s before retry (attempt ${n+1})...`),await new Promise(t=>setTimeout(t,3e4)),c(`🔄 Retrying pixel placement for chunk ${o},${s}...`),await p(t,e,n+1)):i}catch(t){throw t}};e.onclick=async()=>{if(n)return console.log("AUTOFILL: User requested stop"),n=!1,e.textContent="Auto Fill",void c("⏹️ Auto-fill stopped by user");if(!t.o?.St?.Z.length||!t.o?.St?.gt)return console.log("AUTOFILL: No active template available"),void c("❌ No active template available");try{await t.o.Nt()?console.log("Fetched fresh user data for auto-fill"):console.warn("Failed to fetch fresh user data, continuing with cached data")}catch(t){console.error("Error fetching fresh user data:",t)}for(console.log("AUTOFILL: Starting auto fill process"),n=!0,e.textContent="Stop Fill",c("🚀 Auto-fill started!");n;)try{console.log("AUTOFILL: Starting new cycle");const s=t.o?.charges;if(!s){console.log("AUTOFILL: No charge data available, waiting..."),c("⏳ Waiting for charge data..."),await i(5e3);continue}const d=await m(1,u(t.o?.extraColorsBitmap||0));if(console.log(`AUTOFILL: Progress result: ${JSON.stringify(d)}`),console.log(`AUTOFILL: Found ${d.Qt} chunk groups to process`),0===d.Qt){if(console.log("AUTOFILL: Template completed - no more pixels to place"),console.log("AUTOFILL: Closing Paint Menu"),c("🎨 Closing Paint Menu..."),n=!1,e.textContent="Auto Fill",c("🎉 Template completed! All owned color pixels placed."),r(0),window.bmProtectMode){console.log("AUTOFILL: Starting protection mode - monitoring every 10s"),c("🛡️ Protection mode active - monitoring template every 10s");const n=setInterval(async()=>{try{console.log("PROTECT: Checking template integrity..."),c("🔍 Checking template integrity...");const o=u(t.o?.extraColorsBitmap||0);if(0===o.length)return void console.log("PROTECT: No owned colors found, skipping check");const i=await m(0,o);if(i.Qt>0){console.log(`PROTECT: Found ${i.Qt} pixels that need protection!`),c(`🚨 Protection alert: ${i.Qt} pixels need fixing!`);const o=t.o?.charges;if(o&&Math.floor(o.count)>0){const t=Math.min(Math.floor(o.count),i.Qt);console.log(`PROTECT: Attempting to fix ${t} pixels with ${Math.floor(o.count)} charges`),c(`🔧 Fixing ${t} pixels with available charges...`),clearInterval(n),c("🛡️ Protection mode: Restarting auto-fill to fix damaged pixels"),e.click()}else console.log("PROTECT: No charges available for immediate fixing"),c("⚠️ Damage detected but no charges available for fixing")}else console.log("PROTECT: Template is intact"),c("✅ Template protection check: All pixels intact")}catch(t){console.error("PROTECT: Error during protection check:",t),c(`❌ Protection error: ${t.message}`)}},1e4);window.bmProtectionInterval=n}break}if(r(d.Qt),console.log(`AUTOFILL: Current charges: ${s.count}/${s.max}`),s.count<s.max&&d.Qt>Math.floor(s.count)){console.log(`AUTOFILL: Charges not full (${s.count}/${s.max}) and remaining pixels (${d.Qt}) > available charges (${Math.floor(s.count)}), refreshing user data`),c("🔄 Refreshing user data for latest charges..."),await t.o.Nt();const e=t.o?.charges;if(e&&e.count>=e.max){console.log("AUTOFILL: Charges are now full after refresh, proceeding"),c("✅ Charges are now full after refresh!");continue}console.log("AUTOFILL: Still need to wait for charges, calculating wait time");const o=s.max-Math.floor(s.count),r=s.count-Math.floor(s.count),l=s.ne||3e4,u=Math.ceil((1-r)*l)+(o-1)*l;console.log(`AUTOFILL: Waiting ${(u/1e3).toFixed(1)}s for ${o} charges`),c(`⏱️ Precise timing: ${s.count.toFixed(3)}/${s.max} charges, waiting ${a(u/1e3)}`);const h=Date.now()+u;let m=0;for(;Date.now()<h&&n;){const e=Math.max(0,h-Date.now());if(m++,m%10==0){console.log(`AUTOFILL: 10 seconds elapsed (iteration ${m}), refreshing user data`),c(`🔄 ${m}s elapsed - checking charges via data refresh`),await t.o.Nt();const e=t.o?.charges;if(e&&e.count>=e.max){console.log("AUTOFILL: Charges are now full after refresh, breaking wait loop"),c("✅ Charges full after refresh - proceeding immediately!");break}console.log(`AUTOFILL: After refresh - charges: ${e?.count.toFixed(3)}/${e?.max}, continuing wait`),c(`📊 Refresh result: ${e?.count.toFixed(3)}/${e?.max} charges, continuing wait`)}const n=a(e/1e3);c(`⏳ Charging ${n} remaining`),await i(Math.min(1e3,e))}if(!n){console.log("AUTOFILL: Stopped during charge wait");break}console.log("AUTOFILL: Charge wait completed, continuing");continue}s.count<s.max&&(console.log(`AUTOFILL: Charges not full (${s.count}/${s.max}) but sufficient for remaining pixels (${d.Qt}), proceeding with pixel placement`),c(`⚡ Sufficient charges (${Math.floor(s.count)}) for remaining pixels (${d.Qt}), proceeding!`)),console.log("AUTOFILL: Proceeding with pixel placement"),console.log("AUTOFILL: Getting owned colors from extraColorsBitmap..."),c("🔍 Getting owned colors from bitmap...");const h=t.o?.extraColorsBitmap||0,b=u(h);if(console.log(`AUTOFILL: Found ${b.length} owned colors from bitmap ${h}`),0===b.length){console.log("AUTOFILL: No owned colors found from bitmap, retrying in 10s"),c("❌ No owned colors found from bitmap! Retrying in 10s..."),await i(1e4);continue}console.log(`AUTOFILL: Looking for up to ${s.count} pixels to place`),c(`⚡ Charges available (${s.count}/${s.max}). Finding up to ${s.count} pixels from ${b.length} owned colors...`);const f=(await m(s.count,b)).Kt;if(console.log(`AUTOFILL: Found ${f.length} chunk groups to process`),0===d.Qt){console.log("AUTOFILL: Template completed - no more pixels to place"),console.log("AUTOFILL: Closing Paint Menu"),c("🎨 Closing Paint Menu...");const t=document.querySelector(".relative.px-3"),o=t.querySelector('.btn.btn-circle.btn-sm svg path[d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"]')?.closest("button");o&&o.click(),n=!1,e.textContent="Auto Fill",c("🎉 Template completed! All owned color pixels placed."),r(0);break}const g=await l(".btn.btn-primary.btn-lg.sm\\:btn-xl.relative.z-30",{Bt:100,Rt:!0,Wt:200,zt:"AUTOFILL",description:"paint mode button",Gt:""});if(!g.Yt){await i(5e3);continue}g.element.click(),c("✅ Clicked paint mode button"),console.log("Clicked paint mode button"),await i(500);const $=f.reduce((t,e)=>t+e[1].length,0);console.log(`AUTOFILL: Will place ${$} pixels across ${f.length} chunks`),c(`🎯 Found ${$} pixels to place in ${f.length} chunks`);for(let t=0;t<f.length;t++){if(!n){console.log("AUTOFILL: Stopped during chunk processing");break}const e=f[t],[s,a]=e,[r,u]=s;if(console.log(`AUTOFILL: ChunkIndex: ${t}`),t>0){console.log(`AUTOFILL: Reopening paint menu for chunk ${t+1}/${f.length}`),c(`🎨 Reopening paint menu for chunk ${t+1}...`);const e=await l(".btn.btn-primary.btn-lg.sm\\:btn-xl.relative.z-30",{Bt:100,Rt:!1,Wt:200,zt:"AUTOFILL",description:"paint button",Gt:` for chunk ${t+1}`});if(!e.Yt){console.error(`AUTOFILL: Could not find paint button for chunk ${t+1}, skipping chunk`),c(`❌ Could not find paint button for chunk ${t+1}, skipping`);continue}e.element.click(),c(`✅ Paint menu reopened for chunk ${t+1}`),await i(200)}console.log(`AUTOFILL: Processing chunk ${r},${u} with ${a.length} pixels`),c(`🔄 Placing ${a.length} pixels in chunk ${r},${u}...`),await p(s,a),console.log("AUTOFILL: Finished Intercept"),a.forEach(([t,e])=>o.add(`${r},${u},${t},${e}`)),c(`✅ Placed ${a.length} pixels in chunk (${r},${u})`)}console.log(`AUTOFILL: Completed placing ${$} pixels, starting UI cleanup`),n&&(console.log(`AUTOFILL: Batch completed successfully - ${$} pixels placed`),c(`🎯 Batch complete: ${$} pixels placed`)),console.log("AUTOFILL: Waiting before next cycle"),await i(1e4)}catch(t){console.error("AUTOFILL: Error during auto fill cycle:",t),c(`❌ Error: ${t.message}. Retrying in 10s...`),await i(1e4)}}}).p().F({id:"bm-O",textContent:"Mode: Scan",disabled:!0},(t,e)=>{const n=["Scan","Random"];let o=0;e.onclick=()=>{o=(o+1)%n.length,e.textContent=`Mode: ${n[o]}`}}).p().F({id:"bm-H",textContent:"Protect: Off",disabled:!0},(t,e)=>{let n=!1;e.onclick=()=>{n=!n,e.textContent="Protect: "+(n?"On":"Off"),t.R("🛡️ Protection mode "+(n?"enabled":"disabled")),window.bmProtectMode=n,!n&&window.bmProtectionInterval&&(clearInterval(window.bmProtectionInterval),window.bmProtectionInterval=null,t.R("🛡️ Protection monitoring stopped"))}}).p().p().D({id:g.i,placeholder:`Status: Sleeping...\nVersion: ${p}`,readOnly:!0}).p().D({id:"bm-A",placeholder:"Auto-Fill Output:\nWaiting for auto-fill to start...",readOnly:!0}).p().D({id:"bm-z",placeholder:"Progress:\nWaiting for template analysis...",readOnly:!0}).p().T({id:"bm-1"}).T().F({id:"bm-a",className:"bm-q",innerHTML:"🎨",title:"Template Color Converter"},(t,e)=>{e.addEventListener("click",()=>{window.open("https://pepoafonso.github.io/color_converter_wplace/","_blank","noopener noreferrer")})}).p().p().L({textContent:"Made by SwingTheVine",style:"margin-top: auto;"}).p().p().p().$(document.body),setTimeout(()=>{const t=document.querySelector("#bm-B"),e=document.querySelector("#bm-O"),n=document.querySelector("#bm-H");t&&(g.o?.St?.Z.length&&g.o?.St?.gt?(t.disabled=!1,e.disabled=!1,n&&(n.disabled=!1)):(t.disabled=!0,e.disabled=!0,n&&(n.disabled=!0)))},0)}(),g.N("#bm-n","#bm-i"),w.Et(g),new MutationObserver((t,e)=>{const n=document.querySelector("#color-1");if(!n)return;let o=document.querySelector("#bm-g");if(!o){o=document.createElement("button"),o.id="bm-g",o.textContent="Move ↑",o.className="btn btn-soft",o.onclick=function(){const t=this.parentNode.parentNode.parentNode.parentNode,e="Move ↑"==this.textContent;t.parentNode.className=t.parentNode.className.replace(e?"bottom":"top",e?"top":"bottom"),t.style.borderTopLeftRadius=e?"0px":"var(--radius-box)",t.style.borderTopRightRadius=e?"0px":"var(--radius-box)",t.style.borderBottomLeftRadius=e?"var(--radius-box)":"0px",t.style.borderBottomRightRadius=e?"var(--radius-box)":"0px",this.textContent=e?"Move ↓":"Move ↑"};const t=n.parentNode.parentNode.parentNode.parentNode.querySelector("h2");t.parentNode?.appendChild(o)}}).observe(document.body,{childList:!0,subtree:!0}),function(...t){(0,console.log)(...t)}(`%c${m}%c (${p}) userscript has loaded!`,"color: cornflowerblue;","")})();